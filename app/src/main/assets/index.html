<!DOCTYPE html>
<html>
<head>
<title>todo list</title>
<link href="css/main.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="container">
  <ul>

  </ul>
    <input type="text" id="add-item"></input><input type="submit" id="submit-btn"></input>
</div>
<script>

  //retrieve items from local storage
  retrieveFromStorage();

  //dynamically add an <li> element when the submit button is clicked
  
  var submit_btn = document.getElementById('submit-btn'); //get the submit button
  //attach a function to the submit button
  submit_btn.onclick = function additem(){
    var count = new Date().getTime();
    var textInput = document.getElementById('add-item');
    var item = textInput.value;
    var ul = document.getElementsByTagName('ul');
    var li;
    var img;

    createListElement(count,item);
    localStorage.setItem(count, item);
  }

  function retrieveFromStorage(){
    var ul_item = document.getElementsByTagName('ul');

    for(index in localStorage){
      
      var itemValue = localStorage[index];
      var li;

      li = createListElement(index, itemValue);
    }
  }

  
  function createListElement(id, value){
    var textInput = document.getElementById('add-item');
    var ul = document.getElementsByTagName('ul');
    var li;
    var img;

    ul[0].insertAdjacentHTML('beforeend','<li id="' + id +'" class="item">' + value + '</li>');

    li = document.getElementById(id);

    li.addEventListener("touchstart", handleStart);
    li.addEventListener("touchmove", handleMove);
    li.addEventListener("touchend", handleEnd);

    swipe(li);
    
    li.onclick = strikeThrough;
    li.addEventListener("touchstart", strikeThrough);
  }
  

  function handleStart(e){
    e.preventDefault();
    this.style.backgroundColor = "#FFFFCC";
  }

  function handleMove(e){
    e.preventDefault();
    this.style.backgroundColor = "#FFCC66";
  }

  function handleEnd(e){
    e.preventDefault();
    this.style.backgroundColor = "#FFFFFF";
  }

  function strikeThrough(e){
    e.preventDefault();

    if (this.style.textDecoration == "none"){
      this.style.textDecoration = "line-through";
    }else{
      this.style.textDecoration = "none";
    }
  }

  function swipe(element){
    var startx;
    var dist;
    var delta;

    element.addEventListener('touchstart',function(e){
      e.preventDefault();
      startx = parseInt(e.changedTouches[0].pageX);
    });

    element.addEventListener('touchmove', function(e){
      e.preventDefault();
      var x = parseInt(e.changedTouches[0].pageX);
      dist = x - startx;

      move(element,dist,0);
    });

    element.addEventListener('touchend', function(e){
      if (dist > 100){
        localStorage.removeItem(this.id);
        animate(element, 4);
      }else{
        delta = (dist * -1)/2;
        move(element,dist * -1,50);
        move(element,0,0);
      }
    })
  }

  function move(element, dist, speed){
      element.style.transitionDuration = speed + 'ms';
      element.style.webkitTransform = 'translate(' + dist + 'px,0)';
  }

  function slide(e) {

    var speed = 10;
    var dist = 1000;

    this.style.transform = 'translateX(10px)';
      this.style.transitionDuration = speed + 'ms';
      this.style.webkitTransform = 'translate(' + dist + 'px,0)' + 'translateZ(0)';
  }


  function animate(element, speed){
    var children = element.childNodes;

    element.style.setProperty('-webkit-transition', 'all 0.5s');
    element.style.setProperty('height', '0px');
    element.style.setProperty('padding', '0px');
    element.style.setProperty('border', '0px');
    element.removeChild(children[0]); //remove text node
  }
  
</script>
</body>
</html>