<!DOCTYPE html>
<html>
<head>
<title>todo list</title>
<link href="css/main.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="container">
	<ul>
		<li id="item0" class="item" style="text-decoration:none" onclick="addStrikeThrough()" ><img id="img1" src="images/delete.png" class="del_image" onclick="addRemove()"></img>Don't forget the milk </li>
	</ul>
		<input type="text" id="add-item"></input><input type="submit" id="submit-btn"></input>
</div>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>
<script>

	retrieveFromStorage();
	
	
	//$('#submit-btn').click(transfer);

	//dynamically add an <li> element when the submit button is clicked
	
	var submit_btn = document.getElementById('submit-btn'); //get the submit button
	//attach a function to the submit button
	submit_btn.onclick = function additem(){
		var count = localStorage.length;
		console.log(localStorage.length);

		var item_value = document.getElementById('add-item').value;
		var li_element = document.createElement('li');
		var img_element = document.createElement('img');
		var text_element = document.createTextNode(item_value);

		li_element.setAttribute("id", "item" + (count + 1));
		li_element.setAttribute("class","item");
		img_element.setAttribute("src","images/delete.png");
		img_element.setAttribute("class", "del_image");

		li_element.appendChild(img_element);
		li_element.appendChild(text_element);

		var ul_item = document.getElementsByTagName('ul'); //this return an array of value so  we use [0]

		//add touch listeners
		li_element.addEventListener("touchstart", handleStart, false);
		li_element.addEventListener("touchmove", handleMove, false);
		li_element.addEventListener("touchend", handleEnd);
		
		li_element.onclick = strikethrough;
		img_element.onclick = removeItem;

		ul_item[0].appendChild(li_element);

		localStorage.setItem(li_element.id, item_value);
		
	}

	function retrieveFromStorage(){
		var ul_item = document.getElementsByTagName('ul');
		var count = localStorage.length;

		for(index in localStorage){
			
			var itemValue = localStorage[index];
			var li;
			/*
			var li_element = document.createElement('li');
			var img_element = document.createElement('img');
			var text_element = document.createTextNode(item_value);

			li_element.setAttribute("id", "item" + count++);
			li_element.setAttribute("class","item");
			img_element.setAttribute("src","images/delete.png");
			img_element.setAttribute("class", "del_image");

			li_element.appendChild(img_element);
			li_element.appendChild(text_element);

			var ul_item = document.getElementsByTagName('ul'); //this return an array of value so  we use [0]

			//add touch listeners
			li_element.addEventListener("touchstart", handleStart, false);
			li_element.addEventListener("touchmove", handleMove, false);
			li_element.addEventListener("touchend", handleEnd);
			
			li_element.onclick = strikethrough;
			img_element.onclick = removeItem;
			

			ul_item[0].appendChild(li_element);
			*/

			li = createListElement(index, itemValue);
			ul_item[0].appendChild(li);
		}
	}

	function createListElement(id, value){
		var li = document.createElement('li');
		var img = document.createElement('img');
		var text = document.createTextNode(value);

		li.setAttribute("id", id);
		li.setAttribute("class","item");
		
		img.setAttribute("src","images/delete.png");
		img.setAttribute("class", "del_image");

		li.appendChild(img);
		li.appendChild(text);

		li.addEventListener("touchstart", handleStart);
		li.addEventListener("touchmove", handleMove);
		li.addEventListener("touchend", handleEnd);
		li.addEventListener("onclick", strikethrough);
		img.addEventListener("onclick", removeItem);
		img.addEventListener("touchstart", removeItem);

		//img.onclick = removeItem;

		return li;
	}

	function transfer(){
		var item = $('#add-item').val();
		$('ul').append('<li class="item"><img src="images/delete.png" class="del_image"></img>' + item + '</li>');
		striketru();
		remove();
	}

	$('ul').sortable({appendTo:'body'});

	function remove(){
		$('.del_image').click(
			function(){
				var parent = $(this).parent();
				$(parent).css('display', 'none');
				console.log(parent);
			}
		);
	}
	

	//striketru();
	//remove();

	//touchevents
	var items = document.getElementsByClassName('item');
	//items[0].addEventListener("touchstart", handleStart, false);
	//items[0].addEventListener("touchmove", handleMove, false);

	function handleStart(e){
		this.style.backgroundColor = "#FFFFCC";
	}

	function handleMove(e){
		this.style.backgroundColor = "#FFCC66";
	}

	function handleEnd(e){
		this.style.backgroundColor = "#FFFFFF";
	}

	function strikethrough(){
		console.log(this);

		if (this.style.textDecoration == "none"){
			this.style.textDecoration = "line-through";
		}else{
			this.style.textDecoration = "none";
		}
	}

	function addStrikeThrough(){
		document.getElementById("item1").onclick=strikethrough;
	}

	function addRemove(){
		document.getElementById("img1").onclick=removeItem;
	}

	function removeItem(){
		this.parentNode.setAttribute("style","display:none");

		if (this.parentNode.id in localStorage){
			localStorage.removeItem(this.parentNode.id); 
		} else {
			alert("whoa");
		}
		localStorage.removeItem(this.parentNode.id);
		console.log(this.parentNode.id);
	}

	//function handleMove(e){
	//	items.forEach(function(){
	//		alert('this');
	//	});
	//}
	
</script>
</body>
</html>